# О выполнении тестового задания

Перед началом тестирования необходимо запустить окружение и проверить работоспособность в соответствии с инструкцией по установке (инструкция сохранена в папке 'web').

Программное обеспечение для тестирования реализовано с помощью Python и Robot Framework в папке 'services'.<br>
Файл requirements.txt описывает внешние зависимости проекта (пакеты), необходимые для установки.<br>
В папке 'web' сохранены файлы, необходимые для сборки docker-контейнера.<br>
В папке 'services' находится разработанное ПО.<br>
Внутри папки 'services' в папке 'library' поставляются следующие файлы:<br>
- \__init__.py для определения библиотек подключения.
- config.py для настройки глобальных переменных (место нахождение базы данных, адрес и порт узла с API, а также описанные в задании 'headers').
- библиотеки, подключаемые Robotframework'ом:
    - DBRequests.py - описаны методы, реализующие запросы в базу данных.
    - Api.py - описаны методы для работы с API.

Для запуска тестов используйте файл testing.robot из папки 'services'.
Для сохранения результатов теста в отдельной папке 'results' запустите программу pybot с ключом '-d results', выбор браузера для его проведения не важен: **pybot -d results testing.robot**

Алгоритм проведения теста:
1. Подключаются библиотеки.
2. Перед тестовым случаем выполняется подключение к базе данных (Test Setup) - алгоритм подключения и сохранения глобальных переменных 'db\_connection' (информация о подключении к БД)  и 'db\_cursor' (курсор БД) с помощью Keyword - 'Get Connection And Cursor DB'.
3. После тестового примера (Test Teardown) - отключение от базы данных по имеющейся переменной 'db_connection'.
4. Первый тест проверяет наличие базы данных.
5. Второй тест проверяет соединение с адресом и портом узла с API.
6. Третий тест выполняет логику, описанную в тестовом задании:
    1. Попытка выбора из базы данных одного первого попавшегося пользователя с положительным балансом. В случае отсутствия пользователей с данным требованием в базе данных создается новый пользователь с именем 'Monsen' и балансом '5.0' (информация об идентификаторе и балансе пользователя сохраняются в переменных 'client\_id' и 'client\_balance').
    2. Получение списка подключенных услуг из API, сохранение их идентификаторов в переменной 'hooked_services'.
    3. Получение списка всех доступных услуг, сохранение их идентификаторов в переменной 'all_services'.
    4. В списке всех доступных услуг находится неподключенная для клиента 'client\_id' услуга. Идентификатор услуги и стоимость подключения услуги сохраняются в переменных 'service\_id' и 'service\_cost'.
    5. Подключение услуги 'service\_id' клиенту 'client\_id', проверка кода ответа API сервиса осуществляется внутри метода.
    6. Выполняется ожидание до тех пор, пока новая услуга не появится в списке подключенных (поиск по идентификатору). Максимально допустимое время ожидания 1 минута, иначе тест считается проваленным.
    7. Выбор из БД баланса клиента, его сохранение в переменной 'new\_balance\_from\_db'.
    8. Сравнение конечного баланса из БД ('new\_balance\_from\_db') с разницей начального баланса ('client\_balance') со стоимостью подключения услуги ('service\_cost'). В случае если значения не равны - тест провален, возвращается ошибка.

В связи с запуском в docker-контейнере в виртуальном окружении невозможно обратиться к БД и произвести изменения в ней из локального окружения, в связи с чем условия '8(viii)' об эквивалентности значений балансов выполняться не будут, и тест считается проваленным. Удаление записей после выполнения теста не выполнялись по тем же причинам.
